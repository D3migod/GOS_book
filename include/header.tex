%document information
%\documentclass[a5paper,openany,9pt]{extbook}
\documentclass[a5paper,9pt]{extbook}
%\documentclass[10pt,a4paper]{book}

% packages
\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}

 
\usepackage{indentfirst} 
\usepackage{amsmath,amsthm,amssymb,amscd} 						
%\usepackage[margin=1.6cm, top=1.2cm,right=1.6cm,left=2.2cm, footskip = 1 cm, headheight=20pt,headsep=0.2cm]{geometry}

%FOR PRINTING OUTPUT VERSION you should uncomment next statement.
\usepackage[margin=1.6cm, top=1.2cm,right=1.9cm,left=1.9cm, footskip = 1 cm, headheight=20pt,headsep=0.2cm]{geometry}
\usepackage{emptypage}

\usepackage{epigraph}
\usepackage{tikz}
\usepackage{cancel}
															
\usepackage{xcolor}
\definecolor{darkblue}{rgb}{0,0,.6}
\definecolor{Purplemountainmajesty}{RGB}{150, 120, 182}

\usepackage{datetime}
\usepackage{lipsum}

%\usepackage{enumitem}
%\setlist{nosep}
     
%\forloop[hstepi]{hcounter i}{hinitial valuei}{hconditioni}{hcodei}
\usepackage{forloop}
%\newcounter{ct}
%\forloop{ct}{1}{\value{ct} < 10}{\arabic{ct} \\}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%         WRAPPING PICTURES                 %%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{graphicx}
\usepackage{caption}
\usepackage{microtype}
\input{insbox.tex}
\usepackage{threeparttable}
\usepackage{changepage}
\usepackage{xargs}
\usepackage{wrapfig}
\usepackage{printlen}    
\newcounter{ct}

\newlength\imageheight

\newcount\narrowlinect
\narrowlinect=0\relax 
    
%РАБОТАЮЩИЙ ВЕЗДЕ В ТЕКСТЕ СЧЕТЧИК РИСУНОЧКОВ.
\newcounter{pictnumber}[chapter] 
\renewcommand{\thepictnumber}{\thechapter.\arabic{pictnumber}}


 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%RULES. Pls check it everytime.
  %NOT WRAPPED BUT VERY EASY.
  %\usepict[〈height of the textheight〉]{〈picture〉}	

  %for ez text
  %\mywrappict[〈number of narrow lines〉] [〈overhang〉] {〈width〉}
  
  % IT WORKS EVERYWHERE EXCEPT LISTS and beginning of theorems!
  %\addpicture[〈number of narrow lines〉]{〈exactly picture〉}[〈after line〉]{〈width of \textwidth picture will occupy〉}
 
  %It is more complex and more cool variant than previous one.
  %\InsertPict[〈number of narrow lines〉]{〈exactly picture〉}[〈after line〉]{〈width of \textwidth picture will occupy〉}
  % do not forget about super function for lists: \wrapitem - just put it 
  
  %For Theorems and smth like proof. ONE PICTURE TO ONE text box
  %\addmppict[〈this partial of 3 argument picture will occupy, correction!〉]{〈exactly picture〉}{〈width of \textwidth picture will occupy〉]}〈text of theorem〉}

    %SEE THE MOST POWERFUL CONSTRUCTION, but it is hard to set.
  %\wrappicture[number of narrow lines of item]{textoffirstitem}[number of narrow lines in the second item]{ratio of textwidth}[text in the second item]{picture}[number of untouched lines]
  
    % NOW IT IS USELESS, but can work if nothing helps.
  %\addpictureitem[number of narrow lines]{exactly picture}{width of \textwidth will picture occupy}{text}
    
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\usepict}[2][0.2]{
\begin{center}
\includegraphics[height=#1\textheight]{pictures/#2}\refstepcounter{pictnumber}\label{#2} {Рис. \thepictnumber}
\end{center}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\newcommand{\mywrappict}[3][]{
  \begin{wrapfigure}[#1]{o}{#3\textwidth}
  \includegraphics[width=#3\textwidth]{#2}
  \refstepcounter{pictnumber}
  \caption*{Рис. \thepictnumber}
  \end{wrapfigure}}
  
    
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
  
\newcommand{\addmppictL}[4][1]{%
\noindent
\begin{minipage}[t]{#3\textwidth}
\addpicture{#2}{#1}
\end{minipage}%
\hfill%
\begin{minipage}[t]{\dimexpr(1\textwidth-#3\textwidth-2mm)}
#4
\end{minipage}}

\newcommand{\addmppictR}[4][1]{%
\noindent
\begin{minipage}[t]{\dimexpr(1\textwidth-#3\textwidth-2mm)}
#4
\end{minipage}%
\hfill%
\begin{minipage}[t]{#3\textwidth}
\addpicture{#2}{#1}
\end{minipage}}

\newcommand{\addmppict}[4][1]{%
\strictpagecheck%
\checkoddpage%
\ifoddpage
\addmppictR[#1]{#2}{#3}{#4}
\else%
\addmppictL[#1]{#2}{#3}{#4}
\fi%
}

  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
  
\newcommandx\addpictureR[4][1=0,3=0]{\refstepcounter{pictnumber}%
\settoheight\imageheight{\includegraphics[width=#4\textwidth]{#2}}
\narrowlinect=\imageheight\relax
\setcounter{ct}{\numexpr((\narrowlinect)/\baselineskip+2)\relax}
\InsertBoxR{#3}{\begin{threeparttable}%
\begin{tabular}{c@{}}\includegraphics[width=#4\textwidth]{#2}\end{tabular}%
\caption*{Рис. \thepictnumber}\end{threeparttable}}[\numexpr(\value{ct}/2+#1+1)]}

\newcommandx\addpictureL[4][1=0,3=0]{\refstepcounter{pictnumber}%
\settoheight\imageheight{\includegraphics[width=#4\textwidth]{#2}}
\narrowlinect=\imageheight\relax
\setcounter{ct}{\numexpr((\narrowlinect)/\baselineskip+2)\relax}
\InsertBoxL{#3}{\begin{threeparttable}%
\begin{tabular}{c@{}}\includegraphics[width=#4\textwidth]{#2}\end{tabular}%
\caption*{Рис. \thepictnumber}\end{threeparttable}}[\numexpr(\value{ct}/2+#1+1)]}

\newcommandx{\addpicture}[4][1=0,3=0]{%
\strictpagecheck%
\checkoddpage%
\ifoddpage
\addpictureR[#1]{#2}[#3]{#4}
\else%
\addpictureL[#1]{#2}[#3]{#4}
\fi%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\addpictureitemL}[4][9]{
\refstepcounter{pictnumber}
  \parbox[t]{\dimexpr\textwidth-\leftmargin}{%
      \vspace{-2.5mm}
      \begin{wrapfigure}[#1]{l}{#3\textwidth}
        \centering
        \vspace{-\baselineskip}
        \includegraphics[width=#3\textwidth]{#2}
        \caption*{Рис. \thepictnumber}
      \end{wrapfigure}#4}}

\newcommand{\addpictureitemR}[4][9]{
\refstepcounter{pictnumber}
  \parbox[t]{\dimexpr\textwidth-\leftmargin}{%
      \vspace{-2.5mm}
      \begin{wrapfigure}[#1]{r}{#3\textwidth}
        \centering
        \vspace{-\baselineskip}
        \includegraphics[width=#3\textwidth]{#2}
        \caption*{Рис. \thepictnumber}
      \end{wrapfigure}#4}}

\newcommand{\addpictureitem}[4][9]{%
\strictpagecheck%
\checkoddpage%
\ifoddpage%
\addpictureitemR[#1]{#2}{#3}{#4}%
\else%
\addpictureitemL[#1]{#2}{#3}{#4}%
\fi%
}      

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
          
%you can add CT-FUNCTION HERE  IF IT IS NECESSARY
          
\newcommandx{\wrappicture}[7][1=12,3=8,5=\mbox{},7=0]
	{
\refstepcounter{pictnumber}  
  	\parbox[t]{\dimexpr\textwidth-\leftmargin}
		{%
      	\vspace{-2.5mm}
     		\begin{wrapfigure}[#1]{o}{#4\textwidth}
        	\centering
        	\vspace{-\baselineskip}
        		\InsertBoxL{#7}
        			{\begin{threeparttable}%
						\begin{tabular}{c@{}}\includegraphics[width=#4\textwidth]{#6}\end{tabular}%
						\caption*{Рис. \arabic{pictnumber}}{}\end{threeparttable}}      	
      		\end{wrapfigure}#2
      \parbox[t]{\dimexpr\textwidth-\leftmargin}{%
      \vspace{-2.5mm}
      \begin{wrapfigure}[#3]{r}{#4\textwidth}
      \end{wrapfigure}
       #5}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
       
    \usepackage{booktabs}
    %\usepackage{nccmath}
    %\usepackage{etoolbox}
      
    \newcommand*{\wrapitem}{\apptocmd{\labelenumi}{\hskip\leftmargin}{}{}\item\apptocmd{\labelenumi}{\hskip-\leftmargin}{}{}}
    %
    \newcommandx{\InsertPictL}[4][1=0,3=0]{\refstepcounter{pictnumber}%
    \setlength{\leftskip}{\leftmargin}\mbox{}\vspace*{-\baselineskip}%
    \InsertBoxL{#1}{\begin{threeparttable}%
\begin{tabular}{c@{}}\includegraphics[width=#4\textwidth]{#2}\end{tabular}%
\caption*{Рис. \thepictnumber}\end{threeparttable}}[#3]\par \hspace{\itemindent}
    }%
    
    \newcommandx{\InsertPictR}[4][1=0,3=0]{\refstepcounter{pictnumber}%
    \mbox{}\vspace*{-\baselineskip}\setlength{\leftskip}{\leftmargin}%
    \InsertBoxR{#1}{\hskip-\leftmargin\begin{threeparttable}%
\begin{tabular}{c@{}}\includegraphics[width=#4\textwidth]{#2}\end{tabular}%
\caption*{Рис. \thepictnumber}\end{threeparttable}\hskip\leftmargin}[#3]
    }%

\newcommandx{\InsertPict}[4][1=0,3=0]{%
\strictpagecheck%
\checkoddpage%
\ifoddpage
\InsertPictR[#1]{#2}[#3]{#4}
\else%
\InsertPictL[#1]{#2}[#3]{#4}
\fi%
}    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%       END OF  WRAPPING PICTURES           %%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
\newcommand{\nopar}% obviates end-of-paragraph effects
{\rule{\linewidth}{0pt}\vspace*{-\baselineskip}}
% \usepackage{picins}
%\usepackage{mdwlist}

%%%%%%%%%%%%%%%%%
%\begin{enumerate}
%\parpic[r]{\includegraphics[width=3cm]{image.jpg}}
%\item it had line after line but didn't touch the image...
%\item it had line after line but didn't touch the image...
%\item it had line after line but didn't touch the image...
%\item it had line after line but didn't touch the image...
%\suspend{enumerate}
%\resume{enumerate}
%\item ...and filled the remaining space
%\end{enumerate}

%\makeatletter
%\newcommand*\replicate[1]{%
%  \expandafter\replicate@aux\romannumeral\number\numexpr #1\relax000Q{}
%}
%\newcommand*\replicate@aux[1]{\csname replicate@aux@#1\endcsname}
%\newcommand\replicate@aux@m{}
%\long\def\replicate@aux@m#1Q#2#3{\replicate@aux#1Q{#2#3}{#3}}
%\newcommand\replicate@aux@Q[2]{#1}
%\DeclareRobustCommand*\MyParShape[3]{%
%    \parshape = #1
%      \replicate{#1 -1}{#2\textwidth #3\textwidth}%
%      0pt\textwidth
%}
%\newcommand*\my@parshape{}
%\makeatother

%%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  
%%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  %%%%%%%%%%%%  
    
\usepackage{titlesec, titletoc}
\titleformat{\chapter}[display]
  {\raggedright\normalfont\Large\bfseries}{\chaptertitlename\thechapter}{2ex}{}

\titleformat{\section}
  {\normalfont\Large\bfseries}{\thesection.}{1em}{}
\renewcommand{\thesection}{\textsection\arabic{section}}
\titlecontents{section}[2.7em]{\addvspace{0.5ex}}%
 {\contentslabel[\thecontentslabel.]{1.25em}\hskip0.8em}%numbered
 {}%numberless%
 {\enspace\titlerule*[0.7pc]{.}\contentspage}%

\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection}.}
  
\usepackage{fancyhdr}
  \pagestyle{fancy}
\fancyfoot[C]{\thepage}
\fancyhead{}
\fancyhead [CE] {\nouppercase{\slshape \small \rightmark}}
\fancyhead [CO] {\nouppercase{\slshape \small \leftmark}}
\renewcommand{\chaptermark}[1]{%
 \markboth{\ifnum\value{secnumdepth}>-1 \chaptertitlename\thechapter \fi}{}%
}

\addto\captionsrussian{\renewcommand{\chaptername}{Билет №}}
   
% page settings 
\parindent=0.6cm

%переносы в формулах после бинарных операций и отношений, 10000 - запрет, 0 - можно.
%\binoppenalty=10000
%\relpenalty=10000

% front page
\author{Андрей Диденко}
\title{Подготовка к ГОСу по МатАнализу \LaTeX
\thanks{Спасибо всем моим друзьям за поддержку в написании этого документа}
\date{16 Апреля 2016}}
  
% other settings
\pdfcompresslevel=9
\pdfobjcompresslevel=9

%own commands

\newtheoremstyle{note}%
{3pt}% Space above1
{3pt}% Space below1
{}% Body font
{}% Indent amount2
{\bfseries}% Theorem head font
{.}% Punctuation after theorem head
{.5em}% Space after theorem head3
{}% 

\theoremstyle{note}
\newtheorem{defn}{Определение}[chapter]
\renewcommand{\thedefn}{\arabic{defn}}
\newcommand{\theHdefn}{\thechapter.\arabic{defn}}

\newtheorem{defnn}{Определение} %штрихованное.
\renewcommand{\thedefnn}{\arabic{defn}'}
\newcommand{\theHdefnn}{\thechapter.\arabic{defnn}'}


\theoremstyle{plain}
\newtheorem{thm}{Теорема}[chapter]
\renewcommand{\thethm}{\arabic{thm}}
\newcommand{\theHthm}{\thechapter.\arabic{thm}}

\newtheorem{thmn}{Теорема}[chapter] %штрихованное.
\renewcommand{\thethmn}{\arabic{thm}'}
\newcommand{\theHthmn}{\thechapter.\arabic{thmn}'}


\newtheorem{cons}{Следствие}[chapter]
\renewcommand{\thecons}{\arabic{cons}}
\newcommand{\theHcons}{\thechapter.\arabic{cons}}

\newtheorem{consn}{Cледствие}[chapter] %штрихованное.
\renewcommand{\theconsn}{\arabic{cons}'}
\newcommand{\theHconsn}{\thechapter.\arabic{consn}'}


\newtheorem{lemm}{Лемма}[chapter]
\renewcommand{\thelemm}{\arabic{lemm}}
\newcommand{\theHlemm}{\thechapter.\arabic{lemm}}

\newtheorem{lemmn}{Лемма}[chapter] %штрихованное.
\renewcommand{\thelemmn}{\arabic{lemm}'}
\newcommand{\theHlemmn}{\thechapter.\arabic{lemmn}'}
  
\newtheorem{exmpl}{Пример}[chapter]
\renewcommand{\theexmpl}{\arabic{exmpl}}
\newcommand{\theHexmpl}{\thechapter.\arabic{exmpl}}

\newtheorem{stt}{Утверждение}[chapter]
\renewcommand{\thestt}{\arabic{stt}}
\newcommand{\theHstt}{\thechapter.\arabic{stt}}

\newtheorem{exerc}{Упражнение}[chapter]
\renewcommand{\theexerc}{\arabic{exerc}}
\newcommand{\theHexerc}{\thechapter.\arabic{exerc}}

\newtheorem{axiome}{Аксиома}[chapter]
\renewcommand{\theaxiome}{\arabic{axiome}}
\newcommand{\theHaxiome}{\thechapter.\arabic{axiome}}

\newtheorem{axiomen}{Аксиома}[chapter] %штрихованное.
\renewcommand{\theaxiomen}{\arabic{axiome}'}
\newcommand{\theHaxiomen}{\thechapter.\arabic{axiomen}'}

\newtheorem*{notion}{Замечание}

\numberwithin{equation}{chapter}
\renewcommand{\theequation}{\arabic{equation}}
\newcommand{\theHequation}{\thechapter.\arabic{equation}}

\newenvironment{solution}
  {\begin{proof}[Решение.]}
  {\end{proof}}

%\renewcommand\qedsymbol{$\triangle$}

%special mention


\usepackage[breaklinks,pdftex,hyperindex,unicode]{hyperref}	
\hypersetup{
  pdftitle           = {\texorpdfstring{GOS Book Matan}{GOS Book Matan}},
  pdfauthor          = {Didenko Andre},
  pdfsubject         = {Matan},
  pdfstartview       = {FitH},
  pdfborder          = {0 0 0},
  bookmarksopen      = true,
  bookmarksnumbered  = true,
  bookmarksopenlevel = 2,
  colorlinks = true,     
  		linkcolor  = darkblue, 
  		urlcolor = Purplemountainmajesty
}

%conflicting order of packages
\usepackage{extarrows}
\usepackage{rmathbr}
